<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zte.wechart.dao.WechartManagerMapper">
  <resultMap id="BaseResultMap" type="com.zte.wechart.entity.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 27 14:33:30 CST 2017.
    -->
    <id column="USERID" jdbcType="VARCHAR" property="user_id" />
    <result column="JIANCEDATE" jdbcType="VARCHAR" property="jiance_date" />
    <result column="PAYDATE" jdbcType="VARCHAR" property="pay_date" />
    <result column="USERSSY" jdbcType="VARCHAR" property="user_ssy" />
    <result column="USERSZY" jdbcType="VARCHAR" property="user_szy" />
    <result column="USERXL" jdbcType="VARCHAR" property="user_xl" />
    <result column="PAYMONEY" jdbcType="VARCHAR" property="pay_money" />
    <result column="EQUIPID" jdbcType="VARCHAR" property="equipid" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 27 14:33:30 CST 2017.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
    <select id="getCharts" parameterType="com.zte.wechart.entity.UserInfoExample" resultMap="BaseResultMap">
  		SELECT * FROM user_info 

	    <if test="_parameter != null">
	      <include refid="Example_Where_Clause" />
	    </if>
  		
  		ORDER BY jiance_date DESC 
  		
  		<if test="limitStart != null and limitStart&gt;=0">
  	  		limit #{limitStart} ,
    	</if> 
    	<if test="limitEnd != null and limitEnd&gt;=0">
  	  		 #{limitEnd}
    	</if> 
  </select>
   <insert id="insertData" parameterType="com.zte.wechart.entity.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 06 16:04:01 CST 2017.
    -->
    insert into user_info (fid, user_id, jiance_date, 
      insert_date, user_ssy, user_szy,user_pjy,info_status,user_xl,equipid,pay_from,pay_status,order_id)
    values (#{fid,jdbcType=VARCHAR}, #{user_id,jdbcType=VARCHAR}, #{jiance_date,jdbcType=VARCHAR}, 
      #{insert_date,jdbcType=VARCHAR}, #{user_ssy,jdbcType=VARCHAR}, #{user_szy,jdbcType=VARCHAR}
      , #{user_pjy,jdbcType=VARCHAR},#{info_status,jdbcType=VARCHAR}, #{user_xl,jdbcType=VARCHAR},
        #{equipid,jdbcType=VARCHAR}, #{pay_from,jdbcType=VARCHAR}, 
       #{pay_status,jdbcType=VARCHAR},#{order_id,jdbcType=VARCHAR}
      )
  </insert>
   <insert id="insertData2" parameterType="com.zte.wechart.entity.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 06 16:04:01 CST 2017.
    -->
    insert into user_info (fid, user_id, jiance_date,pay_date,
      insert_date, user_ssy, user_szy,user_pjy,info_status,user_xl,equipid,pay_from,pay_status,order_id)
    values (#{fid,jdbcType=VARCHAR}, #{user_id,jdbcType=VARCHAR}, #{jiance_date,jdbcType=VARCHAR}, #{pay_date,jdbcType=VARCHAR}, 
      #{insert_date,jdbcType=VARCHAR}, #{user_ssy,jdbcType=VARCHAR}, #{user_szy,jdbcType=VARCHAR}
      , #{user_pjy,jdbcType=VARCHAR},#{info_status,jdbcType=VARCHAR}, #{user_xl,jdbcType=VARCHAR},
        #{equipid,jdbcType=VARCHAR}, #{pay_from,jdbcType=VARCHAR}, 
       #{pay_status,jdbcType=VARCHAR},#{order_id,jdbcType=VARCHAR}
      )
  </insert>
   <select id="getCheckData" parameterType="java.lang.String" resultType="com.zte.wechart.entity.UserInfo">
  		select * from user_info where  order_id = #{0} AND PAY_STATUS = "1"  LIMIT 1
  </select>
  
  <update id="updateData" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 06 16:13:21 CST 2017.
    -->
    update user_info
    <set>
        ORDER_ID = #{0,jdbcType=VARCHAR},
        PAY_STATUS = #{1,jdbcType=VARCHAR},
        PAY_MONEY = #{2,jdbcType=VARCHAR},
        PAY_DATE = #{5,jdbcType=VARCHAR},
    </set>
	WHERE USER_ID= #{3} AND EQUIPID = #{4} AND PAY_STATUS="0" ORDER BY INSERT_DATE DESC LIMIT 1 
  </update>
    <update id="updateSend" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 06 16:13:21 CST 2017.
    -->
    update user_info
    <set>
        SEND_STATUS = "1"
    </set>
	WHERE ORDER_ID=#{0}
  </update>
  
   <select id="getResDate" parameterType="java.lang.String" resultType="java.util.HashMap">
  		<!-- select substring_index(jiance_date," ",1) as resdate, substring_index(substring_index(jiance_date," ",-1),":",2) as restime,user_ssy,user_szy,user_xl from user_info where user_id="oxNV8w_xGftJeaeEWPhAv2NjDUoM" and pay_status="1" ORDER BY resdate DESC -->
       select CONCAT(substring_index(jiance_date,"-",1),"年",substring_index(substring_index(jiance_date,"-",2),'-',-1),"月",substring_index(substring_index(jiance_date," ",1),'-',-1),"日") as resdate from user_info where user_id=#{0} and pay_status="1" and zhaohui = "0" GROUP BY resdate ORDER BY resdate DESC
  </select>
   <select id="getListDate" parameterType="java.lang.String" resultType="java.util.HashMap">
  		select CONCAT(substring_index(jiance_date,"-",1),"年",substring_index(substring_index(jiance_date,"-",2),'-',-1),"月",substring_index(substring_index(jiance_date," ",1),'-',-1),"日") as resdate, substring_index(substring_index(jiance_date," ",-1),":",2) as restime,user_ssy,user_szy,user_xl,jiance_date from user_info where user_id=#{0} and pay_status="1" and zhaohui = "0" ORDER BY jiance_date DESC 
       
  </select>
  
    <select id="getPayDate" parameterType="java.lang.String" resultType="java.util.HashMap">
  		<!-- select substring_index(jiance_date," ",1) as resdate, substring_index(substring_index(jiance_date," ",-1),":",2) as restime,user_ssy,user_szy,user_xl from user_info where user_id="oxNV8w_xGftJeaeEWPhAv2NjDUoM" and pay_status="1" ORDER BY resdate DESC -->
       select CONCAT(substring_index(pay_date,"-",1),"年",substring_index(substring_index(pay_date,"-",2),'-',-1),"月") as resdate,CONCAT(substring_index(substring_index(pay_date,"-",2),'-',-1),"月",substring_index(substring_index(pay_date," ",1),'-',-1),"日") as resmonth,substring_index(substring_index(pay_date," ",1),'-',-1) as resday,count(*) as countpay,sum(pay_money*100)/100 as summoney  from user_info where user_id=#{0} and pay_status="1" and zhaohui = "0" GROUP BY resdate ORDER BY pay_date DESC
  </select>
   <select id="getPayListDate" parameterType="java.lang.String" resultType="java.util.HashMap">
  		select CONCAT(substring_index(pay_date,"-",1),"年",substring_index(substring_index(pay_date,"-",2),'-',-1),"月") as resdate,CONCAT(substring_index(substring_index(pay_date,"-",2),'-',-1),"月",substring_index(substring_index(pay_date," ",1),'-',-1),"日") as resmonth,  substring_index(substring_index(pay_date," ",-1),":",2) as restime,user_ssy,user_szy,user_xl,pay_from,pay_money from user_info where user_id=#{0} and pay_status="1" and zhaohui = "0" ORDER BY pay_date DESC 
  </select>
  
    <select id="checkSendStatus" parameterType="java.lang.String" resultType="com.zte.wechart.entity.UserInfo">
  		select * from user_info where user_id=#{0} and send_status="0" and pay_status = "1" ORDER BY pay_date desc
  </select>
  <select id="sumCheckData" parameterType="java.lang.String" resultType="java.util.HashMap">
  		select count(*) as totalRes ,pay_status from user_info where user_id=#{0} and equipid=#{1} and jiance_date=#{2} ORDER BY jiance_date desc limit 1
  </select>
  <select id="sumRecordInfoBySnno" parameterType="java.lang.String" resultType="java.util.HashMap">
  		SELECT COUNT(*) AS RES FROM record_info WHERE SN_NO = #{0}
  </select>
  <select id="insertRecordInfo" parameterType="java.lang.String" resultType="java.lang.String">
  		INSERT INTO record_info SET SN_NO=#{0},SSY=#{1},SZY=#{2},MB=#{3},INSERT_DATE=#{4}
  </select>
  <select id="updateRecordInfo" parameterType="java.lang.String" resultType="java.lang.String">
  		UPDATE record_info SET SSY=#{1},SZY=#{2},MB=#{3},INSERT_DATE=#{4} WHERE SN_NO = #{0}
  </select>
  <select id="getRecordInfo" parameterType="java.lang.String" resultType="com.zte.wechart.entity.RecordInfo">
  		SELECT * FROM record_info WHERE SN_NO=#{0} ORDER BY INSERT_DATE DESC LIMIT 1
  </select>
  <delete id="delRecordInfo" parameterType="java.lang.String">
      DELETE FROM record_info WHERE SN_NO = #{0}
  </delete>
    <select id="getLastData" parameterType="java.lang.String" resultType="com.zte.wechart.entity.UserInfo">
  		select * from user_info where jiance_date > date_add(now(),interval -30 minute) and user_id=#{0} and equipid=#{1} and pay_status = 0  limit 1
  </select>
     <select id="sumGetLastData" parameterType="java.lang.String" resultType="java.lang.Integer">
  		select count(*) as sumLastData from user_info where jiance_date > date_add(now(),interval -30 minute) and user_id=#{0} and equipid=#{1} and pay_status = 0 limit 1
  </select>
  <select id="sumRecord" parameterType="java.lang.String" resultType="java.lang.Integer">
  		
	SELECT count(*) as recordSum FROM record_info WHERE  SN_NO=#{0} ORDER BY INSERT_DATE DESC LIMIT 1 
  </select>
  
  <select id="getQushi" parameterType="com.zte.wechart.entity.UserInfoExample" resultType="com.zte.wechart.entity.UserInfo">
  		SELECT * FROM user_info 

	    <if test="_parameter != null">
	      <include refid="Example_Where_Clause" />
	    </if>
  		
  		ORDER BY jiance_date ASC 
  </select>
  <select id="getZhaoHuiInfo" parameterType="java.lang.String" resultType="java.lang.Integer">
         <![CDATA[
	select count(*) as numInfo from user_info where jiance_date>=#{0} and jiance_date<=#{1} and user_ssy=#{2} and user_szy=#{3} and user_xl=#{4}  and equipid =#{5} and zhaohui="0"  ORDER BY jiance_date desc limit 1
   		]]>
  </select>
  <update id="updateByEquipid" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 19 14:48:46 CST 2017.
    -->
    update user_info
    set zhaohui = "1"
    where equipid = #{0} ORDER BY jiance_date desc limit 1

  </update>
  
  <select id="getOperationBySnNo" parameterType="java.lang.String" resultType="java.lang.String">
    SELECT OPERATION_ID FROM equip WHERE SN_NO = #{0}
  </select>
  
  <select id="sumInterface" parameterType="java.lang.String" resultType="java.lang.Integer">
	SELECT count(*) FROM interface WHERE  OPERATION_ID = #{0} AND TYPE = #{1}
  </select>
  
  <select id="getInterface" parameterType="java.lang.String" resultType="java.lang.String">
    SELECT URL FROM interface WHERE OPERATION_ID = #{0} AND TYPE = #{1}
  </select>
  
  <select id="getOperationName" parameterType="java.lang.String" resultType="java.lang.String">
    SELECT NAME FROM operations WHERE ID = #{0}
  </select>
  
  <select id="getdata" parameterType="java.lang.String" resultType="com.zte.wuser.entity.JianCeInfo">
    SELECT SSY as ssy, SZY as szy, MB as mb, INSERT_DATE as insertDate FROM jiance_info WHERE SN_NO = #{0} ORDER BY INSERT_DATE DESC LIMIT 50;
  </select>
  	
</mapper>